---
title: "Computer workshop 4:Linear models with continuous predictors"
author: "Last updated"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    code_folding: show
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
answer_sheet <- TRUE # Put this to TRUE to generate the workshop sheet with answers, FALSE to generate the worskhop sheet without answers
```

# Learning objectives
1.  being able to formulate research questions
2.	being able to work through a robust statistical modelling process:
    a.  performing basic data exploration
    b.	fitting a linear model with continuous predictors in MINITAB
    c.	understanding how to validate the assumptions of the model
    d.	being able to interpret the parameters of the model
    e.	representing the model graphically
    
## Optional: Repeat of the Linear Model analyses from the lecture, using Galton’s Height data.
After checking for outlier(s), try to reproduce the analysis in the previous lecture today, to find out how the Height of a child become adult can be predicted from the average height of its parents, using a simple linear model.

You will find the Galton heights data on MyAberdeen (MyAberdeen > Content Area > Topic Four - Linear Model with continuous predictor > DATA SETS).

Do not forget to specify the null and alternative hypotheses, to **specify the correct options in Minitab,** and to check the validity of the model assumptions before interpreting and reporting the results.

## The most perfect thing
Bird eggs are fascinating structures. Their size, structure and colours respond to numerous constraints and selection pressures exerted by the life history of the species, by their physical environment or by parasites, to cite just a few. In fact, if you are anything like interested in birds and evolution, one fascinating natural history bedside reading for this year could be this one: The Most Perfect Thing: Inside (and Outside) a Bird’s Egg (2016) by Tim Birkhead.

This week, we will explore a tiny corner of bird eggs natural history, using a data set of egg mass in finches (Fringillidae). This small data set\* will take us through the week, illustrating all the topics this course covers, regarding linear models.

Today we will look at the relationship between egg mass (column “Egg_mass”) and female body mass (column “F_mass”) across finch species.

![](workshop_4_the_most_perfect_thing.jpg)

# Instructions
## Download the data and Import in R
The finch egg data can be found here: (MyAberdeen > Content Area > Topic Four - Linear Model with continuous predictor > DATA SETS) with various formats for you to choose from.

```{r}
#Set working directory to your BI3010 folder using the drop down menu: session > set working directory > choose directory
eggs <- read.table("FinchEggs.txt", header = TRUE)
```

## Research question 
In a hypothesis-testing type of inference, the research question could be formulated as:

H~0~: there is no relationship between egg mass and female mass across finch species.
    
H~1~: there is a relationship between egg mass and female mass in finches.

In an estimation-driven type of inference, one could simply say they are interested in estimating the direction and strength (size) of the effect of female body mass on egg mass.

**1.  Is there one that seems more useful to you, in this particular context?**
```{r, include=answer_sheet, class.source="bg-success"}
# The hypothesis being rather trivial, hypothesis-testing is not particularly helpful here, if not counter-productive (why run a statistical test for something quite so obvious?).  The estimation of the size and shape of the effect is rather more interesting.
```

## Exploring the data (before fitting any model)
-  Histogram of response variable 
-  Response variable against order of observation in the data set 
-  Predictor variable (also known as “covariate”) against order of observation in the data set
-  Response variable against predictor (“covariate”)

```{r}
hist(eggs$Egg_mass)
plot(eggs$Egg_mass)
plot(eggs$F_mass)
plot(eggs$Egg_mass ~ eggs$F_mass)
```


**2.  What does the distribution of the response look like?** 
```{r, include=answer_sheet, class.source="bg-success"}
# Far from normal. Skewed to the right. This is not necessarily a problem for a linear model. Although the response is assumed to come from (= be generated by) a normal process, the mean of that normal distribution may be different between observations and therefore the raw data need not necessarily follow a normal distribution. Only the residuals (raw data – expected mean) are required to be normally distributed. 
```

**3.  Are there any outliers or dubious data?** 
```{r, include=answer_sheet, class.source="bg-success"}
# Graph 2: possibly some outliers near the end of the data set with egg masses >6 g or so (hard to tell without further info)
# Graph 3: possibly some outliers near the end of the data set with female masses >70 g or so (hard to tell without further info)
# Graph 4: the above were not outliers in the (X, Y) space; In fact, if outliers exist the candidates would rather be in some of the <60 g species
```

**4.  Do you need to assess the normality of the response variable? Of the covariate(s)?**
```{r, include=answer_sheet, class.source="bg-success"}
# No to both. 
# The response variable is assumed to come from a normal distribution, around the expected mean. 
# Paradoxically, because the expected mean depends on the covariate(s), we don’t expect the raw response variable to look normally-distributed, until we subtract the expected mean. Subtracting the expected mean (the value predicted by the fitted model for that particular observation) is what residuals of the model do, and that’s why the only reliable way to assess the normality assumption is using the residuals of the model. Therefore, we can only check the normality assumption of a linear model AFTER fitting the model, in the residuals.
# Ideally, we want the covariates to be fairly evenly distributed over their range of values, to avoid having too few data at one end or the other (this would make it difficult to estimate the slope precisely). There is no requirement that covariates are normally distributed in a linear model, unlike the residuals (= the response – model prediction).
 
```

## Fit a model in R that matches the research questions
```{r}
# NEEDS CODE?
```

## Check model assumptions 
Is this model valid? To find out, plot a histogram and/or probability plot of the residuals, a plot of residuals against fitted values, a plot of the Cook’s distances against leverage or residuals against covariates (if there are more than one covariates). 

```{r}
# When using aov, we always create an object for our linear model. This is so we can access the residuals, fitted values, etc.
Model <- aov(eggs$Egg_mass ~ eggs$F_mass)
summary(Model)
hist(Model$residuals)
# CODE FOR PROBABILITY PLOT NEEDED?
plot(Model$residuals ~ Model$fitted.values)
plot(cooks.distance(Model) ~ hatvalues(Model))
```

**5. Are the residuals normally distributed?**
```{r, include=answer_sheet, class.source="bg-success"}
# More or less in the middle, but there is too long a tail particularly to the right and to a lesser extent to the left. Not the best of models but still reasonable.
```

**6. Are the residuals centred on zero all along the fitted values?**
```{r, include=answer_sheet, class.source="bg-success"}
# Again, more or less but we can spot too many negative residuals for small egg masses (fitted values under and around 2) and slightly too many positive residuals for intermediate egg masses (fitted values between 2 and 4). Not the best of models but still does a good enough job for high-level (not too detailed) inference.
```

**7. Is the variance homogeneous all along the fitted values and/or along the covariate values?**
```{r, include=answer_sheet, class.source="bg-success"}
# Some heterogeneity: a few points seem to have a variance higher than the rest (the worst offenders being those possible outliers we spotted earlier).
# It is not clear if the variance changes with the mean because there are very few observations with a high predicted egg mass value (e.g. species with large body mass). There is some indication that the variance in egg mass for the smallest species is rather smaller than for medium and large species. This is not ideal, especially if we were interested in testing hypotheses (incorrect p-values), but not as much of a concern for approximate estimation of general effect size.

```

## Interpret model outputs 
**8.  What are the coefficients of the model and what is their interpretation?**
```{r, include=answer_sheet, class.source="bg-success"}
Model$coefficients
# Intercept: predicted value of the response when the predictor value is zero (here, the model predicts and egg mass of 1.002 g for a female body mass of 0 g – but this is just a hypothetical value: in practice we shouldn’t try to make a prediction for a biologically nonsensical female body mass).
# Slope: size of increment in the response for a unit increment in the covariate. I.e. when female body mass increases by 1 g, egg mass tends to increase by 0.06 g.

```

**9. What can you infer from this model output, with reference to your research question(s)?**
```{r, include=answer_sheet, class.source="bg-success"}
# Egg mass increases (significantly) with female body mass, by about 0.06 g every 1 g increase in body mass.
```

**10. Write down the model equation** 
```{r, include=answer_sheet, class.source="bg-success"}
# egg_mass = 1 + 0.06*female_body_mass
```

**11. Compute predicted egg mass values “by hand” for a female body mass of 0 g, and 100 g.**
```{r, include=answer_sheet, class.source="bg-success"}
# 1 + 0.06*0 = 1 g (biologically nonsensical)
# 1 + 0.06*100 = 7 g
 
```

## Plot the fitted model
Re-plot the raw egg mass data against female body mass and add the fitted line from the model with its standard error. 

```{r}
plot(eggs$Egg_mass ~eggs$F_mass)
abline(1.002, 0.0615)
# The values in abline are the intercept and coefficient from the model. You could also use:
abline(Model)
```

**12.  What do you think about this model: does it fit all the data well? Is it useful?**
```{r, include=answer_sheet, class.source="bg-success"}
# Model fit is good overall, with very tight confidence limits (+/- SE). A few outliers poorly fitted (data points 48, 52 and 184). Egg mass tends to be consistently overestimated for the smallest body masses. Model useful approximation as long as not interested in the details, e.g. making very precise predictions for small body masses. This could be an indication that a curved line would fit better. 
```

\*: Definition of the variables that are not fully self-explanatory:

**Egg_mass, F_mass and M_mass:** species-level average mass (in grams) of, respectively, eggs, adult female and adult male birds.

**F_tarsus:** species-level average tarsus length (mm) of adult female birds.

**Mating_System:** This scoring is supposed to reflect an intensity of male-male competition for mates, increasing from 1 to 5. Categories taken from Dunn et al. (2001): (1) polyandry; (2) monogamy (<5% polygyny); (3) mostly monogamy, but occasional polygyny (5–15% polygyny); (4) mostly polygyny (> 15% polygyny) and (5) lek or promiscuous. Only categories 2, 3 and 4 are found in finches.

**Display:** description of male display behaviours on a five point scale as follows: (1) ground displays only, including displays on trees and bushes; (2) ground displays, but with occasional jumps/leaps into the air; (3) both ground and non-acrobatic flight displays; (4) mainly aerial displays, non-acrobatic; (5) mainly aerial displays, acrobatic. This variable is also meant as a proxy for male-male competition.
This data set is a very small subset of a large database. You can find the full data set and companion information here if you want more information. [Terje Lislevand, Jordi Figuerola and Tamas Szekely (2007) Avian Body Sizes In Relation To Fecundity, Mating System,Display Behavior, And Resource Sharing. Ecological Archives E088-096](https://esajournals.onlinelibrary.wiley.com/doi/pdf/10.1890/06-2054). (Not required: please do this in your own time, not in class)


